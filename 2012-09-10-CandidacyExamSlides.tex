\documentclass[hyperref={bookmarks=false}]{beamer}
\useoutertheme{infolines}
\setbeamertemplate{headline}{} % removes the headline that infolines inserts
% \setbeamertemplate{footline}{
%   \hfill%
%   \usebeamercolor[fg]{page number in head/foot}%
%   \usebeamerfont{page number in head/foot}%
%   \insertpagenumber\,/\,\insertpresentationendpage\kern1em\vskip2pt%
% }
\setbeamertemplate{footline}{
  \hfill%
  \usebeamercolor[fg]{page number in head/foot}%
  \usebeamerfont{page number in head/foot}%
  \insertpagenumber\kern1em\vskip2pt%
}
\setbeamertemplate{navigation symbols}{}
\setbeamercolor{alerted text}{fg=blue}
\setbeamerfont{alerted text}{series=\bfseries,family=\ttfamily}
\AtBeginSection[]
{
  \begin{frame}
    \frametitle{Outline}
    \tableofcontents[currentsection]
  \end{frame}
}
\usepackage[parfill]{parskip}
\usepackage{color}
\usepackage[linewidth=0.5pt]{mdframed}
\newmdenv[innerleftmargin=1mm, innerrightmargin=1mm, innertopmargin=-1mm, innerbottommargin=2mm, leftmargin=-1mm, rightmargin=-1mm]{lstlistinglike}
\usepackage{tikz}
\usepackage{graphicx}
\DeclareGraphicsExtensions{.pdf,.png,.jpg}

\hypersetup{pdfauthor={Eugene Burmako},pdfsubject={Metaprogramming with Macros},pdftitle={Metaprogramming with Macros}}
\title{Scala Macros}

\begin{document}

\title{Metaprogramming with Macros}
\author{Eugene Burmako}
\institute{\'Ecole Polytechnique F\'ed\'erale de Lausanne \\
           \texttt{http://scalamacros.org/}}
\date{10 September 2012}
{
\setbeamertemplate{footline}{}
\begin{frame}
  \titlepage
\end{frame}
}

\begin{frame}[fragile]
\frametitle{Macros}
\pause
Macros realize the notion of textual abstraction.

\pause
Textual abstraction:
\begin{itemize}
\item Recognize pieces of text that match a specification
\item Replace them according to a procedure
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Example}
\begin{semiverbatim}
(let (x 42) (print x))








((lambda (x) (print x)) 42)
\end{semiverbatim}
\end{frame}

\begin{frame}[fragile]
\frametitle{Example}
\begin{semiverbatim}
(let (x 42) (print x))

(defmacro let args
  \visible<2->{(cons}
   \visible<2->{(cons 'lambda}
         \visible<2->{(cons (list (caar args))}
               \visible<2->{(cdr args)))}
   \visible<2->{(cdar args)))}

((lambda (x) (print x)) 42)
\end{semiverbatim}
\end{frame}

\begin{frame}[fragile]
\frametitle{Example}
\begin{semiverbatim}
(let (\text{\color{red}{x}} \text{\color{teal}{42}}) \text{\color{violet}{(print x)}})

(defmacro let args
  (cons
   (cons \text{\color{blue}{'lambda}}
         (cons (list \text{\color{red}{(caar args)}})
               \text{\color{violet}{(cdr args)}}))
   \text{\color{teal}{(cdar args)}}))

((\text{\color{blue}{lambda}} (\text{\color{red}{x}}) \text{\color{violet}{(print x)}}) \text{\color{teal}{42}})
\end{semiverbatim}
\end{frame}

\begin{frame}[fragile]
\frametitle{Why macros?}
\begin{itemize}
\item Deeply embedded DSLs (database access, testing)
\item Optimization (programmable inlining, fusion)
\item Analysis (integrated proof-checker)
\item Effects (effect containment and propagation)
\item ...
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Today's talk}

Macrology is vast:
\begin{itemize}
\item Notation
\item Variable capture
\item Typechecking meta-programs
\item Syntax extensibility
\item ...
\end{itemize}

\pause
Surveyed papers are versatile as well.
\end{frame}

\begin{frame}[fragile]
\frametitle{Today's talk}

Going into all the details is a genuine pleasure
% and I would invite you to share this pleasure with me during the second part of the oral exam.

But instead let me tell you a story
\end{frame}

\begin{frame}[fragile]
\frametitle{Alexandre Dumas}

\begin{center}
\includegraphics[width=5.5cm]{dumas}
\end{center}
\end{frame}

\section{The prelude of macros}

\begin{frame}[fragile]
\frametitle<1>{Anaphoric \texttt{if}}
\frametitle<2>{Anaphoric \texttt{if}}
\frametitle<3>{The \texttt{aif} macro}
\frametitle<4->{Start with a template}
\begin{semiverbatim}
(aif (calculate)
  (print it)
  (error "does not compute"))

\visible<3->{(defmacro aif args}
        \visible<4->{(let*            ((temp  (car args))}
        \visible<4->{                  (it  temp))}
          \visible<4->{(if  temp}
             \visible<4->{(cadr args)}
             \visible<4->{(caddr args))))}

\visible<2->{(let* ((temp (calculate))}
       \visible<2->{(it temp))}
  \visible<2->{(if temp}
    \visible<2->{(print it)}
    \visible<2->{(error "does not compute")))}
\end{semiverbatim}
\end{frame}

\begin{frame}[fragile]
\frametitle{Surround with parentheses}
\begin{semiverbatim}
(aif (calculate)
  (print it)
  (error "does not compute"))

(defmacro aif args
  \alert{(list '}let* \alert{(list (list '}temp  (car args))
  \alert{                  (list '}it \alert{'}temp\alert{))}
    \alert{(list '}if \alert{'}temp
             (cadr args)
             (caddr args)\alert{))})

(let* ((temp (calculate))
       (it temp))
  (if temp
    (print it)
    (error "does not compute")))
\end{semiverbatim}
\end{frame}

\begin{frame}[fragile]
\frametitle{Quasiquote}
\begin{semiverbatim}
(aif (calculate)
  (print it)
  (error "does not compute"))

(defmacro aif args
  \alert{     `}(let*            ((temp  ..........)
                          (it  temp))
          (if  temp
             ............
             ............)))

(let* ((temp (calculate))
       (it temp))
  (if temp
    (print it)
    (error "does not compute")))
\end{semiverbatim}
\end{frame}

\begin{frame}[fragile]
\frametitle{Unquote}
\begin{semiverbatim}
(aif (calculate)
  (print it)
  (error "does not compute"))

(defmacro aif args
  \alert{     `}(let*            ((temp \alert{,(car args)})
                          (it  temp))
          (if  temp
            \alert{,(cadr args)}
            \alert{,(caddr args)})))

(let* ((temp (calculate))
       (it temp))
  (if temp
    (print it)
    (error "does not compute")))
\end{semiverbatim}
\end{frame}

\begin{frame}[fragile]
\frametitle{Unquote}
\begin{semiverbatim}
(aif (calculate)
  (print it)
  (error "does not compute"))

(defmacro      aif args


    `(let* ((temp ,(car args))
            (it temp))
       (if temp
           ,(cadr args)
           ,(caddr args))))

(let* ((temp (calculate))
       (it temp))
  (if temp
    (print it)
    (error "does not compute")))
\end{semiverbatim}
\end{frame}

\begin{frame}[fragile]
\frametitle{Macro by example (MBE)}
\begin{semiverbatim}
(aif (calculate)
  (print it)
  (error "does not compute"))

(define-syntax aif
  (syntax-rules ()
    (\alert{(aif cond then else)}
     (let* ((temp \alert{cond})
            (it temp))
       (if temp
           \alert{then}
           \alert{else})))))

(let* ((temp (calculate))
       (it temp))
  (if temp
    (print it)
    (error "does not compute")))
\end{semiverbatim}
\end{frame}

\begin{frame}[fragile]
\frametitle{Interlude}
\begin{itemize}
\item Macros are regular functions that happen to work with syntax objects
\item Quasiquotes = static templates + dynamic holes
\end{itemize}
\end{frame}

\section{The tale of bindings}

\end{document}